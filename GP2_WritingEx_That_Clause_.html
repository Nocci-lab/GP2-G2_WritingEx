<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Ê∫ñ2 Writing ‰∏¶„ÅπÊõø„ÅàÁ∑¥Áøí</title>

<style>
body{
  font-family:"Hiragino Maru Gothic ProN",sans-serif;
  background:#fff9e6;
  text-align:center;
  padding:20px;
}
.frame{
  border:3px solid #b6d957;
  background:#fff;
  padding:20px;
  max-width:980px;
  margin:auto;
  border-radius:12px;
}
.qnum{font-size:24px;font-weight:bold;}
.grammar{
  font-size:18px;
  color:#2b6cb0;
  margin:6px 0;
  font-weight:bold;
}
.jp{
  font-size:15px;
  color:#666;
  margin-bottom:12px;
}
.row{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(90px,1fr));
  gap:10px;
  margin:14px 0;
}
.slot{
  height:60px;
  border:2px dashed #bbb;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  background:#e6f5e6;
  padding:8px 12px;
  border-radius:8px;
  box-shadow:2px 2px 6px rgba(0,0,0,.25);
  cursor:pointer;
  user-select:none;
  font-size:16px;
  font-weight:bold;
}
button{
  padding:8px 18px;
  font-size:16px;
  margin:6px;
}
#message{
  font-size:20px;
  height:28px;
  font-weight:bold;
}
</style>
</head>

<body>

<h2>Ê∫ñ2 Writing ‰∏¶„ÅπÊõø„ÅàÁ∑¥Áøí</h2>

<div class="frame">
  <div class="qnum" id="qnum"></div>
  <div class="grammar" id="grammar"></div>
  <div class="jp" id="jp"></div>

  <div class="row" id="answerRow"></div>
  <div class="row" id="cardRow"></div>

  <button onclick="checkAnswer()">Check</button>
  <button onclick="shuffle()">Shuffle</button>
  <button id="nextBtn" onclick="nextQ()" style="display:none">NEXT ‚ñ∂</button>
  <button onclick="makePDF()">üìÑ PDF</button>

  <div id="message"></div>
</div>

<canvas id="confetti" style="position:fixed;top:0;left:0;pointer-events:none;"></canvas>

<script>
const data=[
{
 grammar:"ÂΩ¢Âºè‰∏ªË™û it",
 en:["It","is","important","for","students","to","experience","things","outside","of","school","."],
 jp:"ÁîüÂæí„Å´„Å®„Å£„Å¶„ÄÅÂ≠¶Ê†°„ÅÆÂ§ñ„Åß„Åï„Åæ„Åñ„Åæ„Å™„Åì„Å®„ÇíÁµåÈ®ì„Åô„Çã„Åì„Å®„ÅØÈáçË¶Å„Åß„ÅÇ„Çã„ÄÇ"
},
{
 grammar:"ÂΩ¢Âºè‰∏ªË™û it",
 en:["It","is","essential","for","children","to","play","outside","in","order","to","stay","healthy","."],
 jp:"ÂÅ•Â∫∑„Åß„ÅÑ„Çã„Åü„ÇÅ„Å´„ÄÅÂ≠ê„Å©„ÇÇ„ÅåÂ§ñ„ÅßÈÅä„Å∂„Åì„Å®„ÅØ‰∏çÂèØÊ¨†„Åß„ÅÇ„Çã„ÄÇ"
},
{
 grammar:"‰∏ªË™û„ÅÆÂÜÖÂÆπ„ÇíË°®„Åô thatÁØÄ",
 en:["It","is","essential","that","students","have","part-time","jobs","before","they","start","working","as","adults","."],
 jp:"Â§ß‰∫∫„Å®„Åó„Å¶ÂÉç„ÅçÂßã„ÇÅ„ÇãÂâç„Å´„ÄÅÁîüÂæí„Åå„Ç¢„É´„Éê„Ç§„Éà„ÇíÁµåÈ®ì„Åô„Çã„Åì„Å®„ÅØÈáçË¶Å„Åß„ÅÇ„Çã„ÄÇ"
},
{
 grammar:"‰∏ªË™û„ÅÆÂÜÖÂÆπ„ÇíË°®„Åô thatÁØÄ",
 en:["It","is","helpful","for","tourists","that","more","Japanese","people","speak","English","nowadays","."],
 jp:"ËøëÂπ¥„ÄÅ„Çà„ÇäÂ§ö„Åè„ÅÆÊó•Êú¨‰∫∫„ÅåËã±Ë™û„ÇíË©±„Åô„Åì„Å®„ÅØ„ÄÅË¶≥ÂÖâÂÆ¢„Å´„Å®„Å£„Å¶ÂΩπ„Å´Á´ã„Å§„ÄÇ"
},
{
 grammar:"ÂêåÊ†º„ÅÆ thatÁØÄ",
 en:["Having","a","part-time","job","gives","students","the","idea","that","earning","money","isn't","easy","."],
 jp:"„Ç¢„É´„Éê„Ç§„Éà„Çí„Åô„Çã„Åì„Å®„Åß„ÄÅ„ÅäÈáë„ÇíÁ®º„Åê„Åì„Å®„ÅØÁ∞°Âçò„Åß„ÅØ„Å™„ÅÑ„Å®ÁîüÂæí„ÅØÂ≠¶„Å∂„ÄÇ"
},
{
 grammar:"ÂêåÊ†º„ÅÆ thatÁØÄ",
 en:["Participating","in","volunteer","work","gives","students","the","idea","that","helping","others","can","lead","to","a","better","society","."],
 jp:"„Éú„É©„É≥„ÉÜ„Ç£„Ç¢Ê¥ªÂãï„Å´ÂèÇÂä†„Åô„Çã„Åì„Å®„Åß„ÄÅ‰ªñ‰∫∫„ÇíÂä©„Åë„Çã„Åì„Å®„Åå„Çà„ÇäËâØ„ÅÑÁ§æ‰ºö„Å´„Å§„Å™„Åå„Çã„Å®Â≠¶„Å∂„ÄÇ"
},
{
 grammar:"ÂêåÊ†º„ÅÆ thatÁØÄ",
 en:["Participating","in","club","activities","gives","students","the","idea","that","helping","each","other","leads","to","big","achievements","."],
 jp:"ÈÉ®Ê¥ªÂãï„Å´ÂèÇÂä†„Åô„Çã„Åì„Å®„Åß„ÄÅÂçîÂäõ„Åô„Çã„Åì„Å®„ÅåÂ§ß„Åç„Å™ÊàêÊûú„Å´„Å§„Å™„Åå„Çã„Å®Â≠¶„Å∂„ÄÇ"
}
];

let cur=0, dragged=null;

function loadQ(){
  message.textContent="";
  nextBtn.style.display="none";
  const q=data[cur];
  qnum.textContent="Q"+(cur+1);
  grammar.textContent=q.grammar;
  jp.textContent=q.jp;
  answerRow.innerHTML="";
  cardRow.innerHTML="";
  q.en.forEach((w,i)=>{
    answerRow.appendChild(makeSlot());
    cardRow.appendChild(makeSlot(w,i));
  });
  shuffle();
}

function makeSlot(word="",home=null){
  const s=document.createElement("div");
  s.className="slot";
  s.ondragover=e=>e.preventDefault();
  s.ondrop=()=>{ if(dragged && !s.firstChild) s.appendChild(dragged); };
  if(word){
    const c=document.createElement("div");
    c.className="card";
    c.textContent=word;
    c.dataset.home=home;
    c.draggable=true;
    c.onclick=()=>tapMove(c);
    c.ondragstart=()=>dragged=c;
    s.appendChild(c);
  }
  s.onclick=()=>{
    if(s.parentElement.id==="answerRow" && s.firstChild){
      cardRow.children[s.firstChild.dataset.home].appendChild(s.firstChild);
    }
  };
  return s;
}

function tapMove(card){
  const empty=[...answerRow.children].find(s=>!s.firstChild);
  if(empty) empty.appendChild(card);
}

function shuffle(){
  const cards=[...document.querySelectorAll(".card")];
  cardRow.querySelectorAll(".slot").forEach(s=>s.innerHTML="");
  cards.sort(()=>Math.random()-.5)
       .forEach((c,i)=>cardRow.children[i].appendChild(c));
}

function checkAnswer(){
  const ans=[...answerRow.children].map(s=>s.firstChild?.textContent||"");
  if(JSON.stringify(ans)===JSON.stringify(data[cur].en)){
    message.textContent="Correct! ‚úÖ";
    speak();
    nextBtn.style.display="inline-block";
  }else{
    message.textContent="Try again ‚ùå";
  }
}

function speak(){
  const u=new SpeechSynthesisUtterance(data[cur].en.join(" "));
  u.lang="en-US";
  u.rate=0.9;
  speechSynthesis.speak(u);
}

function nextQ(){
  cur++;
  cur===data.length?finish():loadQ();
}

function finish(){
  message.textContent="Perfect! üéâ";
}

function shuffleArray(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function makePDF(){
  const w=window.open("");
  w.document.write(`
  <html><head><style>
  body{font-family:"Hiragino Maru Gothic ProN";padding:24px;}
  h2{text-align:center;}
  .q{margin-bottom:22px;}
  .jp{color:#555;}
  .words{font-size:13px;margin:6px 0;}
  .line{border-bottom:1px solid #000;height:22px;margin-bottom:4px;}
  </style></head><body>
  <h2>Ê∫ñ2 Writing ‰∏¶„ÅπÊõø„ÅàÁ∑¥Áøí</h2>
  Name: ____________„ÄÄDate: ____________
  `);
  data.forEach((q,i)=>{
    const shuffled=shuffleArray(q.en);
    w.document.write(`
      <div class="q">
        <b>Q${i+1}„Äê${q.grammar}„Äë</b><br>
        Ôºà${q.jp}Ôºâ<br>
        <div class="words">${shuffled.join(" / ")}</div>
        <div class="line"></div><div class="line"></div>
      </div>
    `);
  });
  w.document.write("</body></html>");
  w.document.close();
  w.print();
}

loadQ();
</script>
</body>
</html>
